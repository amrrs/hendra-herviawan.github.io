<!DOCTYPE html>
<html lang="en-us">
  <head>
		
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-5CXDD64');</script>
		
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.30.2" />


<title>Univariate logistic regression with Tensorflow - M Hendra Herviawan~Blog</title>
<meta property="og:title" content="Univariate logistic regression with Tensorflow - M Hendra Herviawan~Blog">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="kaggle.com/hendraherviawan/kernels">Kaggle</a></li>
    
    <li><a href="/tutorial/">Tutorial</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    

    <h1 class="article-title">Univariate logistic regression with Tensorflow</h1>

    

    <div class="article-content">
      

<h3 id="m-hendra-herviawan">M Hendra Herviawan</h3>

<h2 id="project-overview">Project Overview</h2>

<p>Logistic regression adalah statistical model untuk menganalisa dataset dimana terdapat satu atau lebih independent variable. Output dari model adalah dichotomi variable (hanya terdapat dua kemungkinan). Sebuah Neuron pada Neural network sebenarnya hanya merupakan sebuah <em>Logistic regression</em> yang menerima satu atau lebih input dan mengeluarkan probabilitas antara 0 dan 1.</p>

<pre><code class="language-python">import numpy as np
import pandas as pd

from sklearn import datasets, metrics, preprocessing
from sklearn.utils import shuffle

training_epochs = 10
batch_size = 90
</code></pre>

<h2 id="load-dataset">Load Dataset</h2>

<pre><code class="language-python">#Load the dataset
df = pd.read_csv(&quot;data/CHD.csv&quot;, header=0)
#Describe the input data
print (df.describe())
</code></pre>

<pre><code>              age        chd
count  100.000000  100.00000
mean    44.380000    0.43000
std     11.721327    0.49757
min     20.000000    0.00000
25%     34.750000    0.00000
50%     44.000000    0.00000
75%     55.000000    1.00000
max     69.000000    1.00000
</code></pre>

<h3 id="normalizing-and-shuffle-the-data">Normalizing and Shuffle the data</h3>

<pre><code class="language-python">#Normalisasi input data
a = preprocessing.StandardScaler()
X =a.fit_transform(df['age'].values.reshape(-1, 1).astype(float))

#Shuffle
x_sf,y_sf = shuffle(X, df['chd'])
</code></pre>

<h2 id="1-tensorflow">1. Tensorflow</h2>

<pre><code class="language-python">import tensorflow as tf
</code></pre>

<pre><code>/home/x/.local/bin/intelpython3/lib/python3.6/importlib/_bootstrap.py:205: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6
  return f(*args, **kwds)
</code></pre>

<pre><code class="language-python">sess = tf.Session()
# tf Graph Input
x = tf.placeholder(&quot;float&quot;, [None, 1]) 
y = tf.placeholder(&quot;float&quot;, [None, 2]) 

# Create model
# Set model weights
W = tf.Variable(tf.zeros([1, 2]))
b = tf.Variable(tf.zeros([2])) #Two Label
</code></pre>

<pre><code class="language-python">learning_rate = 0.2

# Construct model
#pred = tf.matmul(x, W) + b
pred = tf.add(tf.multiply(x, W), b)
activation = tf.nn.softmax(pred) #softmax activation

# Minimize error using cross entropy
cost = tf.reduce_mean(-tf.reduce_sum(y*tf.log(activation), axis=1)) # Cross entropy
optimizer = tf.train.GradientDescentOptimizer(learning_rate).minimize(cost) # Gradient Descent
</code></pre>

<pre><code class="language-python"># Parameters

display_step = 5

# Initializing the variables
init = tf.global_variables_initializer()

# Launch the graph
with tf.Session() as sess:
    #tf.train.write_graph(sess.graph, './graphs','graph.pbtxt')
    sess.run(init)
    #writer = tf.summary.FileWriter('./graphs', sess.graph)
    #Initialize the graph structure
    
    temp=tf.one_hot(indices = y_sf.values, depth=2, on_value = 1, off_value = 0, axis = -1 , name = &quot;a&quot;)  
    
    #Iterate through all the epochs
    for epoch in range(training_epochs):
        avg_cost = 0.
        total_batch = int(90/batch_size) #?
        # Loop over all batches

        for i in range(total_batch):
            # Transform the array into a one hot format
            
            #temp=tf.one_hot(indices = y_sf.values, depth=2, on_value = 1, off_value = 0, axis = -1 , name = &quot;a&quot;)  
            #batch_xs, batch_ys = ((np.transpose([df['age']])-44.38)/11.721327)[:90], temp
            batch_xs, batch_ys = x_sf[:90], temp[:90]
            
            # Fit training using batch data
            sess.run(optimizer, feed_dict={x: batch_xs.astype(float), y: batch_ys.eval()})
            
            # Compute average loss, suming the corrent cost divided by the batch total number
            avg_cost += sess.run(cost, feed_dict={x: batch_xs.astype(float), y: batch_ys.eval()})/total_batch
        # Display logs per epoch step

        if (epoch % display_step == 0) or (epoch+1 == training_epochs):
            print (&quot;Epoch:&quot;, '%05d' % (epoch+1), &quot;cost=&quot;, &quot;{:.8f}&quot;.format(avg_cost))
            print (b.eval())
            print (W.eval())
            print ()
    
    test_X = x_sf[:90] 
    test_Y = temp[:90]
    
    testing_cost = sess.run(
        tf.reduce_sum(tf.pow(pred - y, 2)) / (2 * test_X.shape[0]),
        feed_dict={x: test_X, y: test_Y.eval()})  # same function as cost above
    print(&quot;Testing cost=&quot;, testing_cost)
    #print(&quot;Absolute mean square loss difference:&quot;, abs(
    #    training_cost - testing_cost))
</code></pre>

<pre><code>Epoch: 00001 cost= 0.66957080
[ 0.01111111 -0.01111111]
[[-0.04847416  0.04847416]]

Epoch: 00006 cost= 0.60088885
[ 0.05419367 -0.05419366]
[[-0.23143354  0.23143356]]

Epoch: 00010 cost= 0.57668972
[ 0.07818351 -0.07818349]
[[-0.32850072  0.32850075]]

Testing cost= 0.438686
</code></pre>

<h2 id="2-keras">2. Keras</h2>

<pre><code class="language-python">from keras.models import Sequential
from keras.layers import Dense
</code></pre>

<pre><code>Using TensorFlow backend.
/home/x/.local/bin/intelpython3/lib/python3.6/importlib/_bootstrap.py:205: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6
  return f(*args, **kwds)
</code></pre>

<p>Untuk membuat model di Keras yang pertama dilakukan adalah memanggil fungsi <code>python Sequential()</code> sebagai simbol di mulainya <em>grapht</em>. Karena sebuah Neuron adalah penjabaran dari <em>logistic regression</em> maka untuk mengimplementasikan cukup dengan membuat satu neuron.</p>

<pre><code class="language-python">#Define the model as a logistic regression with
model = Sequential()
model.add(Dense(1, activation='softmax', input_dim=1)) #sigmoid or softmax
model.compile(optimizer='rmsprop', loss='binary_crossentropy', metrics=['accuracy'])
</code></pre>

<pre><code class="language-python"># Fit the model with the first 90 elements, and spliting 70%/30% of them for training/validation sets
model.fit(x_sf[:90], y_sf[:90], epochs=training_epochs, validation_split=0.33, shuffle=True,verbose=1 )
</code></pre>

<pre><code>Train on 60 samples, validate on 30 samples
Epoch 1/10
60/60 [==============================] - 1s 10ms/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 2/10
60/60 [==============================] - 0s 151us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 3/10
60/60 [==============================] - 0s 190us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 4/10
60/60 [==============================] - 0s 186us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 5/10
60/60 [==============================] - 0s 206us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 6/10
60/60 [==============================] - 0s 176us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 7/10
60/60 [==============================] - 0s 213us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 8/10
60/60 [==============================] - 0s 198us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 9/10
60/60 [==============================] - 0s 203us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333
Epoch 10/10
60/60 [==============================] - 0s 221us/step - loss: 9.2997 - acc: 0.4167 - val_loss: 9.0340 - val_acc: 0.4333





&lt;keras.callbacks.History at 0x7f8474b36860&gt;
</code></pre>

<pre><code class="language-python">#Evaluate the model with the last 10 elements
scores = model.evaluate(x_sf[90:], y_sf[90:], verbose=2)
print (model.metrics_names)
print (scores)

</code></pre>

<pre><code>['loss', 'acc']
[7.9711923599243164, 0.5]
</code></pre>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/python.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/julia.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    

    
  </body>
</html>

